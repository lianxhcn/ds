<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>40&nbsp; ex02_吴倩茵 – 数据分析</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../homework/pre/_ex02_朱少荣.html" rel="next">
<link href="../../homework/pre/_ex02_万诗晴.html" rel="prev">
<link href="../../images/ds-book-logo-40.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e8fb9d25728d58bfeac61b497e4a6629.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-8434d2026ae8291579158df2ad8dfa64.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../homework/pre/Dangdang_G7_01_data_clean.html"><strong>作业展示</strong></a></li><li class="breadcrumb-item"><a href="../../homework/pre/_ex02_吴倩茵.html"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">ex02_吴倩茵</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="https://book.lianxh.cn/ds/index.html" class="sidebar-logo-link">
      <img src="../../images/ds-book-logo-40.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../../"></a><a href="../../index.html">DS</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://www.lianxh.cn" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-house-fill"></i></a>
    <a href="https://lianxh-class.cn/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-camera-video-fill"></i></a>
    <a href="https://github.com/arlionn/ds" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">数据分析</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../body/_home.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">关于我们</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../body/00_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">前言</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>Python 基础</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../body/00_py_with_AI_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">借助 AI 写代码</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../body/00_py_with_AI_pic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Ansome Python + AI</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../body/01_1_install-Python-Anocanda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Python：安装和环境配置</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../body/01_2_install_FAQs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Python 安装常见问题</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../body/01_3_markdown.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Markdown</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../body/01_py_01_basic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Python 入门</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../body/01_py_01_basic_01_grammer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Python 代码风格</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../body/01_py_01_basic_02_QuickReference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Python 常用命令速查表</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../body/01_py_01_basic_03_Packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Python 常用扩展包</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../body/01_py_01_basic_04_import.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Python：import 使用详解</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../body/01_py_01_basic_05_OOP.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Python：语法解析-面向对象编程</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../body/01_py_01_basic_06_filepath.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Python 路径设置</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../body/01_py_02_numpy_scipy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">NumPy</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../body/01_py_02_pandas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">pandas 快速入门</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../body/01_py_03_matplotlib.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Matplotlib简介</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../body/01_py_04_func_and_module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">函数</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../body/01_py_05_class.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">类和对象</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>数据分析</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../body/data_02_data_type.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">数据分析是什么？</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../body/data_02_get_data_GMD.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">获取数据：GMD</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../body/TS_SZ_index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">上证指数的时序特征</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>可视化</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../body/graph_01_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Python 可视化：简介</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../body/graph_dis_box_violin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">箱型图和小提琴图</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../body/graph_dis_histogram.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">直方图</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../body/graph_dis_kdensity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">核密度函数图</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>回归分析</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../body/test_AB_test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">A/B test-分组对照试验</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../body/regress_01_OLS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">线性回归模型</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../body/regress_02_wage.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">线性回归分析</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../body/regress_03_binscatter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">分仓散点图</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>时间序列分析</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../body/TS_FRED_US_unemploy_rate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">案例：美国失业率和通胀率关系分析</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>作业展示</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../homework/pre/Dangdang_G7_01_data_clean.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">当当网-G7-01</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../homework/pre/Dangdang_G7_02_data_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">当当网-G7-02</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../homework/pre/G8_China_stock_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">G8-中国上市公司</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../homework/pre/Stock_G4_01_data_crawler.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">G4-01</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../homework/pre/Stock_G4_02_data_cleaning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">G4-02</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../homework/pre/Stock_G4_03_data_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">G4-03</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../homework/pre/_ex02_万诗晴.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">ex02_万诗晴</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../homework/pre/_ex02_吴倩茵.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">ex02_吴倩茵</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../homework/pre/_ex02_朱少荣.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">ex02_朱少荣</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../homework/pre/_ex02_黄伊姿.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">42</span>&nbsp; <span class="chapter-title">ex02_黄伊姿</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#上市公司财务特征分析" id="toc-上市公司财务特征分析" class="nav-link active" data-scroll-target="#上市公司财务特征分析"><span class="header-section-number">41</span> 上市公司财务特征分析</a>
  <ul class="collapse">
  <li><a href="#一理清所需数据" id="toc-一理清所需数据" class="nav-link" data-scroll-target="#一理清所需数据"><span class="header-section-number">41.1</span> 一、理清所需数据</a></li>
  <li><a href="#二数据提取与清洗" id="toc-二数据提取与清洗" class="nav-link" data-scroll-target="#二数据提取与清洗"><span class="header-section-number">41.2</span> 二、数据提取与清洗</a>
  <ul class="collapse">
  <li><a href="#step-1-提取asset_debt表中的变量并增加净资产变量" id="toc-step-1-提取asset_debt表中的变量并增加净资产变量" class="nav-link" data-scroll-target="#step-1-提取asset_debt表中的变量并增加净资产变量"><span class="header-section-number">41.2.1</span> Step 1: 提取「asset_debt」表中的变量，并增加’净资产’变量</a></li>
  <li><a href="#step-2-从cash_flow表中提取相关变量" id="toc-step-2-从cash_flow表中提取相关变量" class="nav-link" data-scroll-target="#step-2-从cash_flow表中提取相关变量"><span class="header-section-number">41.2.2</span> Step 2: 从「cash_flow」表中提取相关变量</a></li>
  <li><a href="#step-3-从常用变量查询年度表中提取相关变量" id="toc-step-3-从常用变量查询年度表中提取相关变量" class="nav-link" data-scroll-target="#step-3-从常用变量查询年度表中提取相关变量"><span class="header-section-number">41.2.3</span> Step 3: 从「常用变量查询（年度）」表中提取相关变量</a></li>
  <li><a href="#step-4-从stk_listedcoinfoanl表中提取相关变量" id="toc-step-4-从stk_listedcoinfoanl表中提取相关变量" class="nav-link" data-scroll-target="#step-4-从stk_listedcoinfoanl表中提取相关变量"><span class="header-section-number">41.2.4</span> Step 4: 从「STK_LISTEDCOINFOANL」表中提取相关变量</a></li>
  <li><a href="#step-5-针对多个缺失值的记录进行删除" id="toc-step-5-针对多个缺失值的记录进行删除" class="nav-link" data-scroll-target="#step-5-针对多个缺失值的记录进行删除"><span class="header-section-number">41.2.5</span> Step 5: 针对多个缺失值的记录进行删除</a></li>
  </ul></li>
  <li><a href="#三数据分析" id="toc-三数据分析" class="nav-link" data-scroll-target="#三数据分析"><span class="header-section-number">41.3</span> 三、数据分析</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../homework/pre/Dangdang_G7_01_data_clean.html"><strong>作业展示</strong></a></li><li class="breadcrumb-item"><a href="../../homework/pre/_ex02_吴倩茵.html"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">ex02_吴倩茵</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">ex02_吴倩茵</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="上市公司财务特征分析" class="level1" data-number="41">
<h1 data-number="41"><span class="header-section-number">41</span> 上市公司财务特征分析</h1>
<p><strong>姓名：</strong> 吴倩茵<br>
<strong>学号：</strong> 24210170</p>
<p><strong>分析任务：</strong><br>
<strong>A .&nbsp;列表呈现如下指标在 2000-今 期间各个年度的&nbsp;平均值，中位数，标准差，最小值&nbsp;和&nbsp;最大值，并作简要分析。（需要对离群值进行处理）</strong> * Lev = 总负债率 = 总负债/总资产 * SL = 流动负债率 = 流动负债/总资产 * LL = 长期负债率 = 长期负债/总资产 * SDR = 短债比率 = 流动负债/总负债 * Cash = 现金比率 = 公司年末持有的现金和现金等价物/总资产 * ROA = 净利润/总资产 * ROE = 净利润/净资产 * SLoan = 短期银行借款/总资产 * LLoan = 长期银行借款/总资产 * Top1 = 第一大股东持股比例 * HHI5 = 前五大股东持股比例平方之和 (赫芬达尔指数) * Size = ln(总资产) * Age = 公司上市年限</p>
<p><strong>B.&nbsp;绘制时序图并作简要分析：</strong><br>
* B1. 横轴为&nbsp;年份，纵轴为&nbsp;Lev&nbsp;的均值和中位数。 * B2. 横轴为&nbsp;年份，纵轴为&nbsp;ROA&nbsp;和&nbsp;Cash&nbsp;的均值 (若有必要可以考虑使用两个纵坐标)。</p>
<p><strong>C.&nbsp;负债率的行业特征分析</strong> * 待分析的行业：&nbsp;制造业 (C)，电力、热力、燃气及水生产和供应业 (D)，交通运输业 (G)，建筑业 (E)，房地产业 (K)，批发和零售业 (F) 以及 金融业 (J) * 算数平均负债率时序图：绘制上述行业在自 2000 年至今各个年度的&nbsp;年平均负债率 (Lev)&nbsp;的时序图，并做简要分析。 * 加权平均负债率时序图：绘制上述行业在自 2000 年至今各个年度的&nbsp;年加权平均负债率 (Lev)&nbsp;的时序图，并做简要分析。Note: 权重可以选择行业内每家公司的总资产；也可以选择行业内每家公司的总市值。 * 简要分析上述两种算法的差别。它们的时序图有何差异？哪一种算法更合理？ * 列表。呈现上述行业在 2001，2003，… 年度上的如下变量的平均值，并作简要分析： * SLoan, LLoan, Lev * Cash, ROA, ROE</p>
<p><strong>D.&nbsp;股权结构分析</strong><br>
* 绘制箱线图。 * 横轴为&nbsp;年份，纵轴为&nbsp;Top1&nbsp;的值。年份取值为：{2001, 2003, 2005, 2007, 2009, 2011, 2013, 2015, 2017, 2019, 2021, 2023}。 * 分析：2005 年，2007 年和 2023 年的箱线图有何区别？原因何在？</p>
<section id="一理清所需数据" class="level2" data-number="41.1">
<h2 data-number="41.1" class="anchored" data-anchor-id="一理清所需数据"><span class="header-section-number">41.1</span> 一、理清所需数据</h2>
<p><strong>目的：</strong> 为了梳理所需数据的来源哪个原始数据表，方便做数据处理 | 变量 | 来源 | 变量 | 来源 | |——-|———|———|———| | 证券代码 | asset_debt_2010 | 股票简称| asset_debt_2010 | | 总资产（元） | asset_debt_2010/asset_debt_2024| 总负债（元） | asset_debt_2010/asset_debt_2024 | | 流动负债（元） | asset_debt_2010/asset_debt_2024 | 长期负债（元） | asset_debt_2010/asset_debt_2024 | | 短期银行借款（元） | asset_debt_2010/asset_debt_2024 | 长期银行借款（元）| asset_debt_2010/asset_debt_2024 | | 公司年末持有的现金和现金等价物（元） | cash_flow_2010/cash_flow_2024 | 净利润（元） | cash_flow_2010/cash_flow_2024 | | 第一大股东比例（%） | 常用变量查询（年度） |HHI5（%） | 常用变量查询（年度） | |行业| STK_LISTEDCOINFOANL |净资产（元） | 计算指标：总资产-总负债 | |时间| 2000-2024 | Age | 计算指标：时间-上市年份 |</p>
<p><strong>备注：</strong> 由于证券代码和股票简称所有原始表都有，选取其中一个较全的证券代码asset_debt_2010作为来源</p>
</section>
<section id="二数据提取与清洗" class="level2" data-number="41.2">
<h2 data-number="41.2" class="anchored" data-anchor-id="二数据提取与清洗"><span class="header-section-number">41.2</span> 二、数据提取与清洗</h2>
<p><strong>目的：</strong> 将所有所需的变量及数据从各个原始数据表提取，便于后续的数据提取以及分析</p>
<section id="step-1-提取asset_debt表中的变量并增加净资产变量" class="level3" data-number="41.2.1">
<h3 data-number="41.2.1" class="anchored" data-anchor-id="step-1-提取asset_debt表中的变量并增加净资产变量"><span class="header-section-number">41.2.1</span> Step 1: 提取「asset_debt」表中的变量，并增加’净资产’变量</h3>
<div id="5a8d1484" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">import</span> warnings</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co"># 忽略openpyxl的样式警告</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>warnings.filterwarnings(<span class="st">'ignore'</span>, category<span class="op">=</span><span class="pp">UserWarning</span>, module<span class="op">=</span><span class="st">'openpyxl'</span>)</span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co"># 读取数据</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>df_2010 <span class="op">=</span> pd.read_excel(<span class="st">'data_raw/asset_debt_2010.xlsx'</span>, dtype<span class="op">=</span>{<span class="st">'证券代码'</span>: <span class="bu">str</span>})</span>
<span id="cb1-9"><a href="#cb1-9"></a>df_2024 <span class="op">=</span> pd.read_excel(<span class="st">'data_raw/asset_debt_2024.xlsx'</span>, dtype<span class="op">=</span>{<span class="st">'证券代码'</span>: <span class="bu">str</span>})</span>
<span id="cb1-10"><a href="#cb1-10"></a></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co"># 需要提取的列名（请根据实际表头调整字段名）</span></span>
<span id="cb1-12"><a href="#cb1-12"></a>cols <span class="op">=</span> [</span>
<span id="cb1-13"><a href="#cb1-13"></a>    <span class="st">'证券代码'</span>, <span class="st">'时间'</span>, </span>
<span id="cb1-14"><a href="#cb1-14"></a>    <span class="st">'资产总计'</span>, <span class="st">'负债合计'</span>, <span class="st">'流动负债合计'</span>, </span>
<span id="cb1-15"><a href="#cb1-15"></a>    <span class="st">'长期负债合计'</span>, <span class="st">'短期借款'</span>, <span class="st">'长期借款'</span>, <span class="st">'上市日期'</span></span>
<span id="cb1-16"><a href="#cb1-16"></a>]</span>
<span id="cb1-17"><a href="#cb1-17"></a></span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="co"># 提取所需列</span></span>
<span id="cb1-19"><a href="#cb1-19"></a>df_2010_sel <span class="op">=</span> df_2010[cols].copy()</span>
<span id="cb1-20"><a href="#cb1-20"></a>df_2024_sel <span class="op">=</span> df_2024[cols].copy()</span>
<span id="cb1-21"><a href="#cb1-21"></a></span>
<span id="cb1-22"><a href="#cb1-22"></a><span class="co"># 提取上市日期的年份</span></span>
<span id="cb1-23"><a href="#cb1-23"></a>df_2010_sel[<span class="st">'上市年份'</span>] <span class="op">=</span> pd.to_datetime(df_2010_sel[<span class="st">'上市日期'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>).dt.year</span>
<span id="cb1-24"><a href="#cb1-24"></a>df_2024_sel[<span class="st">'上市年份'</span>] <span class="op">=</span> pd.to_datetime(df_2024_sel[<span class="st">'上市日期'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>).dt.year</span>
<span id="cb1-25"><a href="#cb1-25"></a></span>
<span id="cb1-26"><a href="#cb1-26"></a><span class="co"># 新增Age列</span></span>
<span id="cb1-27"><a href="#cb1-27"></a>df_2010_sel[<span class="st">'Age'</span>] <span class="op">=</span> df_2010_sel.<span class="bu">apply</span>(</span>
<span id="cb1-28"><a href="#cb1-28"></a>    <span class="kw">lambda</span> row: <span class="bu">max</span>(<span class="dv">0</span>, row[<span class="st">'时间'</span>] <span class="op">-</span> row[<span class="st">'上市年份'</span>]) <span class="cf">if</span> pd.notnull(row[<span class="st">'上市年份'</span>]) <span class="kw">and</span> row[<span class="st">'上市年份'</span>] <span class="op">&lt;=</span> row[<span class="st">'时间'</span>] <span class="cf">else</span> <span class="dv">0</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb1-29"><a href="#cb1-29"></a>df_2024_sel[<span class="st">'Age'</span>] <span class="op">=</span> df_2024_sel.<span class="bu">apply</span>(</span>
<span id="cb1-30"><a href="#cb1-30"></a>    <span class="kw">lambda</span> row: <span class="bu">max</span>(<span class="dv">0</span>, row[<span class="st">'时间'</span>] <span class="op">-</span> row[<span class="st">'上市年份'</span>]) <span class="cf">if</span> pd.notnull(row[<span class="st">'上市年份'</span>]) <span class="kw">and</span> row[<span class="st">'上市年份'</span>] <span class="op">&lt;=</span> row[<span class="st">'时间'</span>] <span class="cf">else</span> <span class="dv">0</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb1-31"><a href="#cb1-31"></a></span>
<span id="cb1-32"><a href="#cb1-32"></a><span class="co"># 合并两个表</span></span>
<span id="cb1-33"><a href="#cb1-33"></a>stock_list <span class="op">=</span> pd.concat([df_2010_sel, df_2024_sel], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-34"><a href="#cb1-34"></a></span>
<span id="cb1-35"><a href="#cb1-35"></a><span class="co"># 保存结果</span></span>
<span id="cb1-36"><a href="#cb1-36"></a>stock_list.to_csv(<span class="st">'data_clean/stock_list.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb1-37"><a href="#cb1-37"></a></span>
<span id="cb1-38"><a href="#cb1-38"></a><span class="co"># 删除不需要的列</span></span>
<span id="cb1-39"><a href="#cb1-39"></a>stock_list.drop(columns<span class="op">=</span>[<span class="st">'上市日期'</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-40"><a href="#cb1-40"></a></span>
<span id="cb1-41"><a href="#cb1-41"></a><span class="co"># 重命名列</span></span>
<span id="cb1-42"><a href="#cb1-42"></a>stock_list.rename(columns<span class="op">=</span>{</span>
<span id="cb1-43"><a href="#cb1-43"></a>    <span class="st">'时间'</span>: <span class="st">'时间'</span>,</span>
<span id="cb1-44"><a href="#cb1-44"></a>    <span class="st">'证券代码'</span>: <span class="st">'证券代码'</span>,</span>
<span id="cb1-45"><a href="#cb1-45"></a>    <span class="st">'上市年份'</span>: <span class="st">'上市年份'</span>,</span>
<span id="cb1-46"><a href="#cb1-46"></a>    <span class="st">'资产总计'</span>: <span class="st">'总资产'</span>,</span>
<span id="cb1-47"><a href="#cb1-47"></a>    <span class="st">'负债合计'</span>: <span class="st">'总负债'</span>,</span>
<span id="cb1-48"><a href="#cb1-48"></a>    <span class="st">'流动负债合计'</span>: <span class="st">'流动负债'</span>,</span>
<span id="cb1-49"><a href="#cb1-49"></a>    <span class="st">'长期负债合计'</span>: <span class="st">'长期负债'</span>,</span>
<span id="cb1-50"><a href="#cb1-50"></a>    <span class="st">'短期借款'</span>: <span class="st">'短期银行借款'</span>,</span>
<span id="cb1-51"><a href="#cb1-51"></a>    <span class="st">'长期借款'</span>: <span class="st">'长期银行借款'</span>,</span>
<span id="cb1-52"><a href="#cb1-52"></a>    <span class="st">'Age'</span>: <span class="st">'Age'</span></span>
<span id="cb1-53"><a href="#cb1-53"></a>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-54"><a href="#cb1-54"></a></span>
<span id="cb1-55"><a href="#cb1-55"></a><span class="co"># 增加列</span></span>
<span id="cb1-56"><a href="#cb1-56"></a>stock_list[<span class="st">'净资产'</span>] <span class="op">=</span> stock_list[<span class="st">'总资产'</span>] <span class="op">-</span> stock_list[<span class="st">'总负债'</span>]</span>
<span id="cb1-57"><a href="#cb1-57"></a></span>
<span id="cb1-58"><a href="#cb1-58"></a><span class="co"># 调整列顺序</span></span>
<span id="cb1-59"><a href="#cb1-59"></a>stock_list <span class="op">=</span> stock_list[[<span class="st">'时间'</span>,<span class="st">'证券代码'</span>,  <span class="st">'上市年份'</span>,<span class="st">'总资产'</span>, <span class="st">'总负债'</span>, <span class="st">'流动负债'</span>, <span class="st">'长期负债'</span>, <span class="st">'短期银行借款'</span>, <span class="st">'长期银行借款'</span>, <span class="st">'净资产'</span> ,<span class="st">'Age'</span>]]</span>
<span id="cb1-60"><a href="#cb1-60"></a></span>
<span id="cb1-61"><a href="#cb1-61"></a><span class="co"># 保存结果</span></span>
<span id="cb1-62"><a href="#cb1-62"></a>stock_list.to_csv(<span class="st">'data_clean/stock_list.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb1-63"><a href="#cb1-63"></a></span>
<span id="cb1-64"><a href="#cb1-64"></a>stock_list.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">时间</th>
<th data-quarto-table-cell-role="th">证券代码</th>
<th data-quarto-table-cell-role="th">上市年份</th>
<th data-quarto-table-cell-role="th">总资产</th>
<th data-quarto-table-cell-role="th">总负债</th>
<th data-quarto-table-cell-role="th">流动负债</th>
<th data-quarto-table-cell-role="th">长期负债</th>
<th data-quarto-table-cell-role="th">短期银行借款</th>
<th data-quarto-table-cell-role="th">长期银行借款</th>
<th data-quarto-table-cell-role="th">净资产</th>
<th data-quarto-table-cell-role="th">Age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2000</td>
<td>000001</td>
<td>1991</td>
<td>6.722750e+10</td>
<td>6.248862e+10</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>4.738884e+09</td>
<td>9</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2000</td>
<td>000002</td>
<td>1991</td>
<td>5.622247e+09</td>
<td>2.656602e+09</td>
<td>2.532706e+09</td>
<td>8.000000e+07</td>
<td>5.660000e+08</td>
<td>8.000000e+07</td>
<td>2.965645e+09</td>
<td>9</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2000</td>
<td>000003</td>
<td>1991</td>
<td>2.494446e+09</td>
<td>2.993068e+09</td>
<td>2.700269e+09</td>
<td>2.272581e+08</td>
<td>1.231221e+09</td>
<td>3.029221e+07</td>
<td>-4.986225e+08</td>
<td>9</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2000</td>
<td>000004</td>
<td>1991</td>
<td>5.082067e+08</td>
<td>3.873043e+08</td>
<td>3.873043e+08</td>
<td>0.000000e+00</td>
<td>2.212000e+08</td>
<td>0.000000e+00</td>
<td>1.209024e+08</td>
<td>9</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2000</td>
<td>000005</td>
<td>1990</td>
<td>2.020667e+09</td>
<td>1.179766e+09</td>
<td>1.016766e+09</td>
<td>1.630000e+08</td>
<td>7.188614e+08</td>
<td>1.630000e+08</td>
<td>8.409006e+08</td>
<td>10</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="step-2-从cash_flow表中提取相关变量" class="level3" data-number="41.2.2">
<h3 data-number="41.2.2" class="anchored" data-anchor-id="step-2-从cash_flow表中提取相关变量"><span class="header-section-number">41.2.2</span> Step 2: 从「cash_flow」表中提取相关变量</h3>
<div id="b6ea1799" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># 读取现金流量表</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>cf_2010 <span class="op">=</span> pd.read_excel(<span class="st">'data_raw/cash_flow_2010.xlsx'</span>, dtype<span class="op">=</span>{<span class="st">'证券代码'</span>: <span class="bu">str</span>})</span>
<span id="cb2-3"><a href="#cb2-3"></a>cf_2024 <span class="op">=</span> pd.read_excel(<span class="st">'data_raw/cash_flow_2024.xlsx'</span>, dtype<span class="op">=</span>{<span class="st">'证券代码'</span>: <span class="bu">str</span>})</span>
<span id="cb2-4"><a href="#cb2-4"></a></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co"># 需要提取的列名（请根据实际表头调整字段名）</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>cf_cols <span class="op">=</span> [<span class="st">'证券代码'</span>, <span class="st">'时间'</span>, <span class="st">'净利润'</span>, <span class="st">'期末现金及现金等价物余额'</span>]</span>
<span id="cb2-7"><a href="#cb2-7"></a></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co"># 提取所需列</span></span>
<span id="cb2-9"><a href="#cb2-9"></a>cf_2010_sel <span class="op">=</span> cf_2010[cf_cols]</span>
<span id="cb2-10"><a href="#cb2-10"></a>cf_2024_sel <span class="op">=</span> cf_2024[cf_cols]</span>
<span id="cb2-11"><a href="#cb2-11"></a></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="co"># 合并两个表</span></span>
<span id="cb2-13"><a href="#cb2-13"></a>cf_all <span class="op">=</span> pd.concat([cf_2010_sel, cf_2024_sel], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-14"><a href="#cb2-14"></a></span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="co"># 重命名列</span></span>
<span id="cb2-16"><a href="#cb2-16"></a>cf_all <span class="op">=</span> cf_all.rename(columns<span class="op">=</span>{<span class="st">'期末现金及现金等价物余额'</span>: <span class="st">'公司年末持有的现金和现金等价物'</span>})</span>
<span id="cb2-17"><a href="#cb2-17"></a></span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="co"># 合并到stock_list</span></span>
<span id="cb2-19"><a href="#cb2-19"></a>stock_list <span class="op">=</span> pd.merge(</span>
<span id="cb2-20"><a href="#cb2-20"></a>    stock_list,</span>
<span id="cb2-21"><a href="#cb2-21"></a>    cf_all,</span>
<span id="cb2-22"><a href="#cb2-22"></a>    on<span class="op">=</span>[<span class="st">'证券代码'</span>, <span class="st">'时间'</span>],</span>
<span id="cb2-23"><a href="#cb2-23"></a>    how<span class="op">=</span><span class="st">'left'</span></span>
<span id="cb2-24"><a href="#cb2-24"></a>)</span>
<span id="cb2-25"><a href="#cb2-25"></a></span>
<span id="cb2-26"><a href="#cb2-26"></a><span class="co"># 保存结果</span></span>
<span id="cb2-27"><a href="#cb2-27"></a>stock_list.to_csv(<span class="st">'data_clean/stock_list.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb2-28"><a href="#cb2-28"></a></span>
<span id="cb2-29"><a href="#cb2-29"></a><span class="co"># 展示前几行</span></span>
<span id="cb2-30"><a href="#cb2-30"></a>stock_list.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">时间</th>
<th data-quarto-table-cell-role="th">证券代码</th>
<th data-quarto-table-cell-role="th">上市年份</th>
<th data-quarto-table-cell-role="th">总资产</th>
<th data-quarto-table-cell-role="th">总负债</th>
<th data-quarto-table-cell-role="th">流动负债</th>
<th data-quarto-table-cell-role="th">长期负债</th>
<th data-quarto-table-cell-role="th">短期银行借款</th>
<th data-quarto-table-cell-role="th">长期银行借款</th>
<th data-quarto-table-cell-role="th">净资产</th>
<th data-quarto-table-cell-role="th">Age</th>
<th data-quarto-table-cell-role="th">净利润</th>
<th data-quarto-table-cell-role="th">公司年末持有的现金和现金等价物</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2000</td>
<td>000001</td>
<td>1991</td>
<td>6.722750e+10</td>
<td>6.248862e+10</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>4.738884e+09</td>
<td>9</td>
<td>5.065518e+08</td>
<td>7.624793e+09</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2000</td>
<td>000002</td>
<td>1991</td>
<td>5.622247e+09</td>
<td>2.656602e+09</td>
<td>2.532706e+09</td>
<td>8.000000e+07</td>
<td>5.660000e+08</td>
<td>8.000000e+07</td>
<td>2.965645e+09</td>
<td>9</td>
<td>3.111773e+08</td>
<td>9.957452e+08</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2000</td>
<td>000003</td>
<td>1991</td>
<td>2.494446e+09</td>
<td>2.993068e+09</td>
<td>2.700269e+09</td>
<td>2.272581e+08</td>
<td>1.231221e+09</td>
<td>3.029221e+07</td>
<td>-4.986225e+08</td>
<td>9</td>
<td>-5.986632e+08</td>
<td>5.801817e+07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2000</td>
<td>000004</td>
<td>1991</td>
<td>5.082067e+08</td>
<td>3.873043e+08</td>
<td>3.873043e+08</td>
<td>0.000000e+00</td>
<td>2.212000e+08</td>
<td>0.000000e+00</td>
<td>1.209024e+08</td>
<td>9</td>
<td>2.248743e+07</td>
<td>6.478023e+07</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2000</td>
<td>000005</td>
<td>1990</td>
<td>2.020667e+09</td>
<td>1.179766e+09</td>
<td>1.016766e+09</td>
<td>1.630000e+08</td>
<td>7.188614e+08</td>
<td>1.630000e+08</td>
<td>8.409006e+08</td>
<td>10</td>
<td>-9.311870e+06</td>
<td>2.911805e+07</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="step-3-从常用变量查询年度表中提取相关变量" class="level3" data-number="41.2.3">
<h3 data-number="41.2.3" class="anchored" data-anchor-id="step-3-从常用变量查询年度表中提取相关变量"><span class="header-section-number">41.2.3</span> Step 3: 从「常用变量查询（年度）」表中提取相关变量</h3>
<div id="6001f6f4" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># 读取常用变量查询（年度）表</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>common_vars <span class="op">=</span> pd.read_excel(<span class="st">'data_raw/常用变量查询（年度）.xlsx'</span>, dtype<span class="op">=</span>{<span class="st">'证券代码'</span>: <span class="bu">str</span>})</span>
<span id="cb3-3"><a href="#cb3-3"></a></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co"># 调整列名</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>common_vars.rename(columns<span class="op">=</span>{<span class="st">'股票代码'</span>: <span class="st">'证券代码'</span>, <span class="st">'会计年度'</span>: <span class="st">'时间'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-6"><a href="#cb3-6"></a></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co"># 需要提取的列名（请根据实际表头调整字段名）</span></span>
<span id="cb3-8"><a href="#cb3-8"></a>common_cols <span class="op">=</span> [<span class="st">'证券代码'</span>, <span class="st">'时间'</span>, <span class="st">'股权集中度1'</span>, <span class="st">'股权集中度9'</span>]</span>
<span id="cb3-9"><a href="#cb3-9"></a></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="co"># 提取所需列</span></span>
<span id="cb3-11"><a href="#cb3-11"></a>common_sel <span class="op">=</span> common_vars[common_cols]</span>
<span id="cb3-12"><a href="#cb3-12"></a></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="co"># 重命名列</span></span>
<span id="cb3-14"><a href="#cb3-14"></a>common_sel <span class="op">=</span> common_sel.rename(columns<span class="op">=</span>{<span class="st">'股权集中度1'</span>: <span class="st">'Top1'</span>, <span class="st">'股权集中度9'</span>: <span class="st">'HHI5'</span>})</span>
<span id="cb3-15"><a href="#cb3-15"></a></span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="co"># Ensure both columns have the same data type</span></span>
<span id="cb3-17"><a href="#cb3-17"></a>stock_list[<span class="st">'证券代码'</span>] <span class="op">=</span> stock_list[<span class="st">'证券代码'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb3-18"><a href="#cb3-18"></a>common_sel[<span class="st">'证券代码'</span>] <span class="op">=</span> common_sel[<span class="st">'证券代码'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb3-19"><a href="#cb3-19"></a></span>
<span id="cb3-20"><a href="#cb3-20"></a><span class="co"># Merge the dataframes</span></span>
<span id="cb3-21"><a href="#cb3-21"></a>stock_list <span class="op">=</span> pd.merge(</span>
<span id="cb3-22"><a href="#cb3-22"></a>    stock_list,</span>
<span id="cb3-23"><a href="#cb3-23"></a>    common_sel,</span>
<span id="cb3-24"><a href="#cb3-24"></a>    on<span class="op">=</span>[<span class="st">'证券代码'</span>, <span class="st">'时间'</span>],</span>
<span id="cb3-25"><a href="#cb3-25"></a>    how<span class="op">=</span><span class="st">'left'</span></span>
<span id="cb3-26"><a href="#cb3-26"></a>)</span>
<span id="cb3-27"><a href="#cb3-27"></a></span>
<span id="cb3-28"><a href="#cb3-28"></a><span class="co"># 保存结果</span></span>
<span id="cb3-29"><a href="#cb3-29"></a>stock_list.to_csv(<span class="st">'data_clean/stock_list.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb3-30"><a href="#cb3-30"></a></span>
<span id="cb3-31"><a href="#cb3-31"></a><span class="co"># 展示前几行</span></span>
<span id="cb3-32"><a href="#cb3-32"></a>stock_list.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">时间</th>
<th data-quarto-table-cell-role="th">证券代码</th>
<th data-quarto-table-cell-role="th">上市年份</th>
<th data-quarto-table-cell-role="th">总资产</th>
<th data-quarto-table-cell-role="th">总负债</th>
<th data-quarto-table-cell-role="th">流动负债</th>
<th data-quarto-table-cell-role="th">长期负债</th>
<th data-quarto-table-cell-role="th">短期银行借款</th>
<th data-quarto-table-cell-role="th">长期银行借款</th>
<th data-quarto-table-cell-role="th">净资产</th>
<th data-quarto-table-cell-role="th">Age</th>
<th data-quarto-table-cell-role="th">净利润</th>
<th data-quarto-table-cell-role="th">公司年末持有的现金和现金等价物</th>
<th data-quarto-table-cell-role="th">Top1</th>
<th data-quarto-table-cell-role="th">HHI5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2000</td>
<td>000001</td>
<td>1991</td>
<td>6.722750e+10</td>
<td>6.248862e+10</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>4.738884e+09</td>
<td>9</td>
<td>5.065518e+08</td>
<td>7.624793e+09</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2000</td>
<td>000002</td>
<td>1991</td>
<td>5.622247e+09</td>
<td>2.656602e+09</td>
<td>2.532706e+09</td>
<td>8.000000e+07</td>
<td>5.660000e+08</td>
<td>8.000000e+07</td>
<td>2.965645e+09</td>
<td>9</td>
<td>3.111773e+08</td>
<td>9.957452e+08</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2000</td>
<td>000003</td>
<td>1991</td>
<td>2.494446e+09</td>
<td>2.993068e+09</td>
<td>2.700269e+09</td>
<td>2.272581e+08</td>
<td>1.231221e+09</td>
<td>3.029221e+07</td>
<td>-4.986225e+08</td>
<td>9</td>
<td>-5.986632e+08</td>
<td>5.801817e+07</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2000</td>
<td>000004</td>
<td>1991</td>
<td>5.082067e+08</td>
<td>3.873043e+08</td>
<td>3.873043e+08</td>
<td>0.000000e+00</td>
<td>2.212000e+08</td>
<td>0.000000e+00</td>
<td>1.209024e+08</td>
<td>9</td>
<td>2.248743e+07</td>
<td>6.478023e+07</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2000</td>
<td>000005</td>
<td>1990</td>
<td>2.020667e+09</td>
<td>1.179766e+09</td>
<td>1.016766e+09</td>
<td>1.630000e+08</td>
<td>7.188614e+08</td>
<td>1.630000e+08</td>
<td>8.409006e+08</td>
<td>10</td>
<td>-9.311870e+06</td>
<td>2.911805e+07</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="step-4-从stk_listedcoinfoanl表中提取相关变量" class="level3" data-number="41.2.4">
<h3 data-number="41.2.4" class="anchored" data-anchor-id="step-4-从stk_listedcoinfoanl表中提取相关变量"><span class="header-section-number">41.2.4</span> Step 4: 从「STK_LISTEDCOINFOANL」表中提取相关变量</h3>
<p>由于原始表中存在多个行业代码，根据目前行业分类标准，此处统一使用 [行业代码D] - 中国上市公司协会行业分类代码</p>
<div id="f76b1561" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># 读取基本信息表</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>info <span class="op">=</span> pd.read_excel(<span class="st">'data_raw/STK_LISTEDCOINFOANL.xlsx'</span>, dtype<span class="op">=</span>{<span class="st">'证券代码'</span>: <span class="bu">str</span>})</span>
<span id="cb4-3"><a href="#cb4-3"></a></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co"># 需要提取的列名（请根据实际表头调整字段名）</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>info_cols <span class="op">=</span> [<span class="st">'证券代码'</span>, <span class="st">'时间'</span>, <span class="st">'行业代码D'</span>]</span>
<span id="cb4-6"><a href="#cb4-6"></a></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co"># 提取所需列</span></span>
<span id="cb4-8"><a href="#cb4-8"></a>info_sel <span class="op">=</span> info[info_cols]</span>
<span id="cb4-9"><a href="#cb4-9"></a></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="co"># 重命名列</span></span>
<span id="cb4-11"><a href="#cb4-11"></a>info_sel <span class="op">=</span> info_sel.rename(columns<span class="op">=</span>{<span class="st">'行业代码D'</span>: <span class="st">'行业代码'</span>})</span>
<span id="cb4-12"><a href="#cb4-12"></a></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="co"># 合并到stock_list</span></span>
<span id="cb4-14"><a href="#cb4-14"></a>stock_list <span class="op">=</span> pd.merge(</span>
<span id="cb4-15"><a href="#cb4-15"></a>    stock_list,</span>
<span id="cb4-16"><a href="#cb4-16"></a>    info_sel,</span>
<span id="cb4-17"><a href="#cb4-17"></a>    on<span class="op">=</span>[<span class="st">'证券代码'</span>, <span class="st">'时间'</span>],</span>
<span id="cb4-18"><a href="#cb4-18"></a>    how<span class="op">=</span><span class="st">'left'</span></span>
<span id="cb4-19"><a href="#cb4-19"></a>)</span>
<span id="cb4-20"><a href="#cb4-20"></a></span>
<span id="cb4-21"><a href="#cb4-21"></a><span class="co"># 保存结果</span></span>
<span id="cb4-22"><a href="#cb4-22"></a>stock_list.to_csv(<span class="st">'data_clean/stock_list.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb4-23"><a href="#cb4-23"></a></span>
<span id="cb4-24"><a href="#cb4-24"></a><span class="co"># 展示前几行</span></span>
<span id="cb4-25"><a href="#cb4-25"></a>stock_list.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">时间</th>
<th data-quarto-table-cell-role="th">证券代码</th>
<th data-quarto-table-cell-role="th">上市年份</th>
<th data-quarto-table-cell-role="th">总资产</th>
<th data-quarto-table-cell-role="th">总负债</th>
<th data-quarto-table-cell-role="th">流动负债</th>
<th data-quarto-table-cell-role="th">长期负债</th>
<th data-quarto-table-cell-role="th">短期银行借款</th>
<th data-quarto-table-cell-role="th">长期银行借款</th>
<th data-quarto-table-cell-role="th">净资产</th>
<th data-quarto-table-cell-role="th">Age</th>
<th data-quarto-table-cell-role="th">净利润</th>
<th data-quarto-table-cell-role="th">公司年末持有的现金和现金等价物</th>
<th data-quarto-table-cell-role="th">Top1</th>
<th data-quarto-table-cell-role="th">HHI5</th>
<th data-quarto-table-cell-role="th">行业代码</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2000</td>
<td>000001</td>
<td>1991</td>
<td>6.722750e+10</td>
<td>6.248862e+10</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>4.738884e+09</td>
<td>9</td>
<td>5.065518e+08</td>
<td>7.624793e+09</td>
<td>NaN</td>
<td>NaN</td>
<td>J66</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2000</td>
<td>000002</td>
<td>1991</td>
<td>5.622247e+09</td>
<td>2.656602e+09</td>
<td>2.532706e+09</td>
<td>8.000000e+07</td>
<td>5.660000e+08</td>
<td>8.000000e+07</td>
<td>2.965645e+09</td>
<td>9</td>
<td>3.111773e+08</td>
<td>9.957452e+08</td>
<td>NaN</td>
<td>NaN</td>
<td>K70</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2000</td>
<td>000003</td>
<td>1991</td>
<td>2.494446e+09</td>
<td>2.993068e+09</td>
<td>2.700269e+09</td>
<td>2.272581e+08</td>
<td>1.231221e+09</td>
<td>3.029221e+07</td>
<td>-4.986225e+08</td>
<td>9</td>
<td>-5.986632e+08</td>
<td>5.801817e+07</td>
<td>NaN</td>
<td>NaN</td>
<td>S91</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2000</td>
<td>000004</td>
<td>1991</td>
<td>5.082067e+08</td>
<td>3.873043e+08</td>
<td>3.873043e+08</td>
<td>0.000000e+00</td>
<td>2.212000e+08</td>
<td>0.000000e+00</td>
<td>1.209024e+08</td>
<td>9</td>
<td>2.248743e+07</td>
<td>6.478023e+07</td>
<td>NaN</td>
<td>NaN</td>
<td>G54</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2000</td>
<td>000005</td>
<td>1990</td>
<td>2.020667e+09</td>
<td>1.179766e+09</td>
<td>1.016766e+09</td>
<td>1.630000e+08</td>
<td>7.188614e+08</td>
<td>1.630000e+08</td>
<td>8.409006e+08</td>
<td>10</td>
<td>-9.311870e+06</td>
<td>2.911805e+07</td>
<td>NaN</td>
<td>NaN</td>
<td>S91</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="step-5-针对多个缺失值的记录进行删除" class="level3" data-number="41.2.5">
<h3 data-number="41.2.5" class="anchored" data-anchor-id="step-5-针对多个缺失值的记录进行删除"><span class="header-section-number">41.2.5</span> Step 5: 针对多个缺失值的记录进行删除</h3>
<div id="9634bfac" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># 复制stock_list为stock_list_clean</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>stock_list_clean <span class="op">=</span> stock_list.copy()</span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co"># 删除总资产、总负债、流动负债、长期负债、短期银行借款、长期银行借款均为缺失值的记录</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>stock_list_clean <span class="op">=</span> stock_list_clean.dropna(subset<span class="op">=</span>[<span class="st">'总资产'</span>, <span class="st">'总负债'</span>, <span class="st">'流动负债'</span>, <span class="st">'长期负债'</span>, <span class="st">'短期银行借款'</span>, <span class="st">'长期银行借款'</span>], how<span class="op">=</span><span class="st">'all'</span>)</span>
<span id="cb5-5"><a href="#cb5-5"></a></span>
<span id="cb5-6"><a href="#cb5-6"></a></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="co"># 检查结果</span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="bu">print</span>(stock_list.head())</span>
<span id="cb5-9"><a href="#cb5-9"></a></span>
<span id="cb5-10"><a href="#cb5-10"></a>stock_list_clean.to_csv(<span class="st">'data_clean/stock_list_clean.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     时间    证券代码  上市年份           总资产           总负债          流动负债          长期负债  \
0  2000  000001  1991  6.722750e+10  6.248862e+10           NaN           NaN   
1  2000  000002  1991  5.622247e+09  2.656602e+09  2.532706e+09  8.000000e+07   
2  2000  000003  1991  2.494446e+09  2.993068e+09  2.700269e+09  2.272581e+08   
3  2000  000004  1991  5.082067e+08  3.873043e+08  3.873043e+08  0.000000e+00   
4  2000  000005  1990  2.020667e+09  1.179766e+09  1.016766e+09  1.630000e+08   

         短期银行借款        长期银行借款           净资产  Age           净利润  \
0           NaN           NaN  4.738884e+09    9  5.065518e+08   
1  5.660000e+08  8.000000e+07  2.965645e+09    9  3.111773e+08   
2  1.231221e+09  3.029221e+07 -4.986225e+08    9 -5.986632e+08   
3  2.212000e+08  0.000000e+00  1.209024e+08    9  2.248743e+07   
4  7.188614e+08  1.630000e+08  8.409006e+08   10 -9.311870e+06   

   公司年末持有的现金和现金等价物  Top1  HHI5 行业代码  
0     7.624793e+09   NaN   NaN  J66  
1     9.957452e+08   NaN   NaN  K70  
2     5.801817e+07   NaN   NaN  S91  
3     6.478023e+07   NaN   NaN  G54  
4     2.911805e+07   NaN   NaN  S91  </code></pre>
</div>
</div>
</section>
</section>
<section id="三数据分析" class="level2" data-number="41.3">
<h2 data-number="41.3" class="anchored" data-anchor-id="三数据分析"><span class="header-section-number">41.3</span> 三、数据分析</h2>
<p>数据分析用的相关变量已在<code>stock_list</code>,分析部分的数据均在<code>stock_list</code>提取</p>
<section id="a-.-列表呈现指定指标在-2000-今-期间各个年度的-平均值中位数标准差最小值-和-最大值并作简要分析" class="level4" data-number="41.3.0.1">
<h4 data-number="41.3.0.1" class="anchored" data-anchor-id="a-.-列表呈现指定指标在-2000-今-期间各个年度的-平均值中位数标准差最小值-和-最大值并作简要分析"><span class="header-section-number">41.3.0.1</span> A .&nbsp;列表呈现指定指标在 2000-今 期间各个年度的&nbsp;平均值，中位数，标准差，最小值&nbsp;和&nbsp;最大值，并作简要分析</h4>
<section id="step-1计算指标" class="level5" data-number="41.3.0.1.1">
<h5 data-number="41.3.0.1.1" class="anchored" data-anchor-id="step-1计算指标"><span class="header-section-number">41.3.0.1.1</span> Step 1:计算指标</h5>
<div id="52dd2064" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb7-3"><a href="#cb7-3"></a></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="co"># 复制 stock_list 表格</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>indicators <span class="op">=</span> stock_list_clean.copy()</span>
<span id="cb7-6"><a href="#cb7-6"></a></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co"># 计算各项指标</span></span>
<span id="cb7-8"><a href="#cb7-8"></a>indicators[<span class="st">'Lev'</span>] <span class="op">=</span> indicators[<span class="st">'总负债'</span>] <span class="op">/</span> indicators[<span class="st">'总资产'</span>]</span>
<span id="cb7-9"><a href="#cb7-9"></a>indicators[<span class="st">'SL'</span>] <span class="op">=</span> indicators[<span class="st">'流动负债'</span>] <span class="op">/</span> indicators[<span class="st">'总资产'</span>]</span>
<span id="cb7-10"><a href="#cb7-10"></a>indicators[<span class="st">'LL'</span>] <span class="op">=</span> indicators[<span class="st">'长期负债'</span>] <span class="op">/</span> indicators[<span class="st">'总资产'</span>]</span>
<span id="cb7-11"><a href="#cb7-11"></a>indicators[<span class="st">'SDR'</span>] <span class="op">=</span> indicators[<span class="st">'流动负债'</span>] <span class="op">/</span> indicators[<span class="st">'总负债'</span>]</span>
<span id="cb7-12"><a href="#cb7-12"></a>indicators[<span class="st">'Cash'</span>] <span class="op">=</span> indicators[<span class="st">'公司年末持有的现金和现金等价物'</span>] <span class="op">/</span> indicators[<span class="st">'总资产'</span>]</span>
<span id="cb7-13"><a href="#cb7-13"></a>indicators[<span class="st">'ROA'</span>] <span class="op">=</span> indicators[<span class="st">'净利润'</span>] <span class="op">/</span> indicators[<span class="st">'总资产'</span>]</span>
<span id="cb7-14"><a href="#cb7-14"></a>indicators[<span class="st">'ROE'</span>] <span class="op">=</span> indicators[<span class="st">'净利润'</span>] <span class="op">/</span> indicators[<span class="st">'净资产'</span>]</span>
<span id="cb7-15"><a href="#cb7-15"></a>indicators[<span class="st">'SLoan'</span>] <span class="op">=</span> indicators[<span class="st">'短期银行借款'</span>] <span class="op">/</span> indicators[<span class="st">'总资产'</span>]</span>
<span id="cb7-16"><a href="#cb7-16"></a>indicators[<span class="st">'LLoan'</span>] <span class="op">=</span> indicators[<span class="st">'长期银行借款'</span>] <span class="op">/</span> indicators[<span class="st">'总资产'</span>]</span>
<span id="cb7-17"><a href="#cb7-17"></a>indicators[<span class="st">'Size'</span>] <span class="op">=</span> np.log(indicators[<span class="st">'总资产'</span>])</span>
<span id="cb7-18"><a href="#cb7-18"></a></span>
<span id="cb7-19"><a href="#cb7-19"></a><span class="co"># 只保留2000-2024年数据</span></span>
<span id="cb7-20"><a href="#cb7-20"></a>indicators <span class="op">=</span> indicators[(indicators[<span class="st">'时间'</span>] <span class="op">&gt;=</span> <span class="dv">2000</span>) <span class="op">&amp;</span> (indicators[<span class="st">'时间'</span>] <span class="op">&lt;=</span> <span class="dv">2024</span>)]</span>
<span id="cb7-21"><a href="#cb7-21"></a></span>
<span id="cb7-22"><a href="#cb7-22"></a><span class="co"># 选择需要保存的列</span></span>
<span id="cb7-23"><a href="#cb7-23"></a>cols_to_save <span class="op">=</span> [</span>
<span id="cb7-24"><a href="#cb7-24"></a>    <span class="st">'时间'</span>, <span class="st">'证券代码'</span>, <span class="st">'Lev'</span>, <span class="st">'SL'</span>, <span class="st">'LL'</span>, <span class="st">'SDR'</span>, <span class="st">'Cash'</span>, <span class="st">'ROA'</span>, <span class="st">'ROE'</span>,</span>
<span id="cb7-25"><a href="#cb7-25"></a>    <span class="st">'SLoan'</span>, <span class="st">'LLoan'</span>, <span class="st">'Top1'</span>, <span class="st">'HHI5'</span>, <span class="st">'Size'</span>, <span class="st">'Age'</span>,<span class="st">'行业代码'</span>,<span class="st">'总资产'</span></span>
<span id="cb7-26"><a href="#cb7-26"></a>]</span>
<span id="cb7-27"><a href="#cb7-27"></a></span>
<span id="cb7-28"><a href="#cb7-28"></a><span class="co"># 保存最终结果</span></span>
<span id="cb7-29"><a href="#cb7-29"></a>indicators <span class="op">=</span> indicators[cols_to_save]</span>
<span id="cb7-30"><a href="#cb7-30"></a>indicators.to_csv(<span class="st">'data_clean/indicators.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb7-31"><a href="#cb7-31"></a></span>
<span id="cb7-32"><a href="#cb7-32"></a><span class="co"># 打印前几行</span></span>
<span id="cb7-33"><a href="#cb7-33"></a><span class="bu">print</span>(indicators.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/site-packages/pandas/core/arraylike.py:402: RuntimeWarning: divide by zero encountered in log
  result = getattr(ufunc, method)(*inputs, **kwargs)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>     时间    证券代码       Lev        SL        LL       SDR      Cash       ROA  \
0  2000  000001  0.929510       NaN       NaN       NaN  0.113418  0.007535   
1  2000  000002  0.472516  0.450479  0.014229  0.953363  0.177108  0.055347   
2  2000  000003  1.199893  1.082513  0.091106  0.902174  0.023259 -0.239998   
3  2000  000004  0.762100  0.762100  0.000000  1.000000  0.127468  0.044249   
4  2000  000005  0.583850  0.503184  0.080666  0.861837  0.014410 -0.004608   

        ROE     SLoan     LLoan  Top1  HHI5       Size  Age 行业代码           总资产  
0  0.106893       NaN       NaN   NaN   NaN  24.931348    9  J66  6.722750e+10  
1  0.104927  0.100671  0.014229   NaN   NaN  22.449997    9  K70  5.622247e+09  
2  1.200634  0.493585  0.012144   NaN   NaN  21.637332    9  S91  2.494446e+09  
3  0.185997  0.435256  0.000000   NaN   NaN  20.046399    9  G54  5.082067e+08  
4 -0.011074  0.355755  0.080666   NaN   NaN  21.426694   10  S91  2.020667e+09  </code></pre>
</div>
</div>
</section>
<section id="step-2处理离群值" class="level5" data-number="41.3.0.1.2">
<h5 data-number="41.3.0.1.2" class="anchored" data-anchor-id="step-2处理离群值"><span class="header-section-number">41.3.0.1.2</span> Step 2:处理离群值</h5>
<div id="2baf708e" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># 读取数据</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="cf">try</span>:</span>
<span id="cb10-3"><a href="#cb10-3"></a>    indicators_list <span class="op">=</span> pd.read_csv(<span class="st">'data_clean/indicators.csv'</span>, dtype<span class="op">=</span>{<span class="st">'证券代码'</span>: <span class="bu">str</span>})</span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb10-5"><a href="#cb10-5"></a>    <span class="bu">print</span>(<span class="st">"读取文件失败："</span>, e)</span>
<span id="cb10-6"><a href="#cb10-6"></a></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="co"># 需要缩尾处理的列</span></span>
<span id="cb10-8"><a href="#cb10-8"></a>winsor_cols <span class="op">=</span> [<span class="st">'Lev'</span>, <span class="st">'SL'</span>, <span class="st">'LL'</span>, <span class="st">'SDR'</span>, <span class="st">'Cash'</span>, <span class="st">'ROA'</span>, <span class="st">'ROE'</span>, </span>
<span id="cb10-9"><a href="#cb10-9"></a>               <span class="st">'SLoan'</span>, <span class="st">'LLoan'</span>, <span class="st">'Top1'</span>, <span class="st">'HHI5'</span>, <span class="st">'Size'</span>, <span class="st">'Age'</span>]</span>
<span id="cb10-10"><a href="#cb10-10"></a></span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="co"># 缩尾处理</span></span>
<span id="cb10-12"><a href="#cb10-12"></a><span class="cf">for</span> col <span class="kw">in</span> winsor_cols:</span>
<span id="cb10-13"><a href="#cb10-13"></a>    <span class="cf">if</span> col <span class="kw">in</span> indicators_list.columns:</span>
<span id="cb10-14"><a href="#cb10-14"></a>        <span class="cf">try</span>:</span>
<span id="cb10-15"><a href="#cb10-15"></a>            lower <span class="op">=</span> indicators_list[col].quantile(<span class="fl">0.01</span>)</span>
<span id="cb10-16"><a href="#cb10-16"></a>            upper <span class="op">=</span> indicators_list[col].quantile(<span class="fl">0.99</span>)</span>
<span id="cb10-17"><a href="#cb10-17"></a>            indicators_list[col] <span class="op">=</span> indicators_list[col].clip(lower, upper)</span>
<span id="cb10-18"><a href="#cb10-18"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb10-19"><a href="#cb10-19"></a>            <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss"> 缩尾处理失败，原因：</span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-20"><a href="#cb10-20"></a>    <span class="cf">else</span>:</span>
<span id="cb10-21"><a href="#cb10-21"></a>        <span class="bu">print</span>(<span class="ss">f"未找到列：</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">，无法缩尾处理"</span>)</span>
<span id="cb10-22"><a href="#cb10-22"></a></span>
<span id="cb10-23"><a href="#cb10-23"></a><span class="co"># 打印结果</span></span>
<span id="cb10-24"><a href="#cb10-24"></a><span class="bu">print</span>(indicators_list[winsor_cols].head(<span class="dv">100</span>))</span>
<span id="cb10-25"><a href="#cb10-25"></a></span>
<span id="cb10-26"><a href="#cb10-26"></a><span class="co"># 保存缩尾处理后的数据</span></span>
<span id="cb10-27"><a href="#cb10-27"></a>indicators_list.to_csv(<span class="st">'data_clean/indicators_winsorized.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Lev        SL        LL       SDR      Cash       ROA       ROE  \
0   0.929510       NaN       NaN       NaN  0.113418  0.007535  0.106893   
1   0.472516  0.450479  0.014229  0.953363  0.177108  0.055347  0.104927   
2   1.103219  0.977726  0.091106  0.902174  0.023259 -0.239998  0.555116   
3   0.762100  0.762100  0.000000  1.000000  0.127468  0.044249  0.185997   
4   0.583850  0.503184  0.080666  0.861837  0.014410 -0.004608 -0.011074   
..       ...       ...       ...       ...       ...       ...       ...   
95  0.441467  0.304085  0.137381  0.688807  0.050357  0.022753  0.040738   
96  0.486699  0.304768  0.181828  0.626193  0.106845  0.032919  0.064133   
97  0.387662  0.169856  0.217759  0.438155  0.030382  0.038239  0.062447   
98  0.165298  0.165298  0.000000  1.000000  0.436141  0.096949  0.116148   
99  0.574906  0.537091  0.076197  0.934224  0.041890  0.050182  0.118049   

       SLoan     LLoan  Top1  HHI5       Size  Age  
0        NaN       NaN   NaN   NaN  24.931348    9  
1   0.100671  0.014229   NaN   NaN  22.449997    9  
2   0.493585  0.012144   NaN   NaN  21.637332    9  
3   0.435256  0.000000   NaN   NaN  20.046399    9  
4   0.355755  0.080666   NaN   NaN  21.426694   10  
..       ...       ...   ...   ...        ...  ...  
95  0.172597  0.137359   NaN   NaN  21.476153    4  
96  0.189045  0.095796   NaN   NaN  20.530494    4  
97  0.078966  0.217749   NaN   NaN  20.754244    4  
98  0.015843  0.000000   NaN   NaN  20.585179    4  
99  0.181547  0.059023   NaN   NaN  21.135884    4  

[100 rows x 13 columns]</code></pre>
</div>
</div>
</section>
<section id="step-3计算各个指标各个年度的-平均值中位数标准差最小值-和-最大值" class="level5" data-number="41.3.0.1.3">
<h5 data-number="41.3.0.1.3" class="anchored" data-anchor-id="step-3计算各个指标各个年度的-平均值中位数标准差最小值-和-最大值"><span class="header-section-number">41.3.0.1.3</span> Step 3:计算各个指标各个年度的&nbsp;平均值，中位数，标准差，最小值&nbsp;和&nbsp;最大值</h5>
<div id="ff638af3" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a><span class="im">import</span> os</span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="co"># 读取已缩尾处理的数据</span></span>
<span id="cb12-4"><a href="#cb12-4"></a>indicators_list_stats <span class="op">=</span> pd.read_csv(<span class="st">'data_clean/indicators_winsorized.csv'</span>, dtype<span class="op">=</span>{<span class="st">'证券代码'</span>: <span class="bu">str</span>})</span>
<span id="cb12-5"><a href="#cb12-5"></a></span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="co"># 需要统计的列</span></span>
<span id="cb12-7"><a href="#cb12-7"></a>stat_cols <span class="op">=</span> [<span class="st">'Lev'</span>, <span class="st">'SL'</span>, <span class="st">'LL'</span>, <span class="st">'SDR'</span>, <span class="st">'Cash'</span>, <span class="st">'ROA'</span>, <span class="st">'ROE'</span>,</span>
<span id="cb12-8"><a href="#cb12-8"></a>             <span class="st">'SLoan'</span>, <span class="st">'LLoan'</span>, <span class="st">'Top1'</span>, <span class="st">'HHI5'</span>, <span class="st">'Size'</span>, <span class="st">'Age'</span>]</span>
<span id="cb12-9"><a href="#cb12-9"></a><span class="co"># 确保需要统计的列为数值类型</span></span>
<span id="cb12-10"><a href="#cb12-10"></a><span class="cf">for</span> col <span class="kw">in</span> stat_cols:</span>
<span id="cb12-11"><a href="#cb12-11"></a>    <span class="cf">if</span> col <span class="kw">in</span> indicators_list_stats.columns:</span>
<span id="cb12-12"><a href="#cb12-12"></a>        indicators_list_stats[col] <span class="op">=</span> pd.to_numeric(indicators_list_stats[col], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb12-13"><a href="#cb12-13"></a></span>
<span id="cb12-14"><a href="#cb12-14"></a><span class="co"># 按年度分组，计算各项统计量</span></span>
<span id="cb12-15"><a href="#cb12-15"></a>stats <span class="op">=</span> indicators_list_stats.groupby(<span class="st">'时间'</span>)[stat_cols].agg([<span class="st">'mean'</span>, <span class="st">'median'</span>, <span class="st">'std'</span>, <span class="st">'min'</span>, <span class="st">'max'</span>])</span>
<span id="cb12-16"><a href="#cb12-16"></a></span>
<span id="cb12-17"><a href="#cb12-17"></a><span class="co"># 展示前几行</span></span>
<span id="cb12-18"><a href="#cb12-18"></a><span class="bu">print</span>(stats.head())</span>
<span id="cb12-19"><a href="#cb12-19"></a></span>
<span id="cb12-20"><a href="#cb12-20"></a><span class="co"># 创建输出文件夹</span></span>
<span id="cb12-21"><a href="#cb12-21"></a>output_dir <span class="op">=</span> <span class="st">'output'</span></span>
<span id="cb12-22"><a href="#cb12-22"></a>os.makedirs(output_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-23"><a href="#cb12-23"></a></span>
<span id="cb12-24"><a href="#cb12-24"></a><span class="co"># 按指标分别保存表格</span></span>
<span id="cb12-25"><a href="#cb12-25"></a><span class="cf">for</span> col <span class="kw">in</span> stat_cols:</span>
<span id="cb12-26"><a href="#cb12-26"></a>    <span class="cf">if</span> col <span class="kw">in</span> stats.columns.levels[<span class="dv">0</span>]:  <span class="co"># 检查指标是否存在于统计结果中</span></span>
<span id="cb12-27"><a href="#cb12-27"></a>        stat_table <span class="op">=</span> stats[col].reset_index()  <span class="co"># 重置索引，保留时间列</span></span>
<span id="cb12-28"><a href="#cb12-28"></a>        output_path <span class="op">=</span> os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">_stats.csv'</span>)</span>
<span id="cb12-29"><a href="#cb12-29"></a>        stat_table.to_csv(output_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb12-30"><a href="#cb12-30"></a>        <span class="bu">print</span>(<span class="ss">f"Saved </span><span class="sc">{</span>col<span class="sc">}</span><span class="ss"> statistics to </span><span class="sc">{</span>output_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb12-31"><a href="#cb12-31"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Lev                                                SL            \
          mean    median       std       min       max      mean    median   
时间                                                                           
2000  0.444084  0.425973  0.196168  0.053559  1.103219  0.382289  0.357834   
2001  0.456666  0.439222  0.203179  0.053559  1.103219  0.389368  0.370755   
2002  0.475764  0.457108  0.201467  0.053559  1.103219  0.407939  0.389565   
2003  0.492857  0.486607  0.208803  0.053559  1.103219  0.420429  0.403829   
2004  0.512312  0.509295  0.211350  0.053559  1.103219  0.435839  0.423285   

                                    ...       Size                       \
           std       min       max  ...       mean     median       std   
时间                                  ...                                   
2000  0.187170  0.036182  0.977726  ...  20.943853  20.876959  0.863413   
2001  0.190278  0.036182  0.977726  ...  21.015491  20.937209  0.908601   
2002  0.188065  0.036182  0.977726  ...  21.078855  20.990890  0.963998   
2003  0.196024  0.036182  0.977726  ...  21.177474  21.103670  1.008694   
2004  0.200821  0.036182  0.977726  ...  21.225106  21.132884  1.057470   

                                 Age                           
            min        max      mean median       std min max  
时间                                                             
2000  18.792218  25.596342  3.744898    4.0  2.448703   0  10  
2001  18.792218  26.610186  4.410175    4.0  2.646555   0  11  
2002  18.792218  26.641245  5.100076    5.0  2.858418   0  12  
2003  18.792218  26.918048  5.789283    6.0  3.093668   0  13  
2004  18.792218  26.918048  6.314033    7.0  3.439637   0  14  

[5 rows x 65 columns]
Saved Lev statistics to output/Lev_stats.csv
Saved SL statistics to output/SL_stats.csv
Saved LL statistics to output/LL_stats.csv
Saved SDR statistics to output/SDR_stats.csv
Saved Cash statistics to output/Cash_stats.csv
Saved ROA statistics to output/ROA_stats.csv
Saved ROE statistics to output/ROE_stats.csv
Saved SLoan statistics to output/SLoan_stats.csv
Saved LLoan statistics to output/LLoan_stats.csv
Saved Top1 statistics to output/Top1_stats.csv
Saved HHI5 statistics to output/HHI5_stats.csv
Saved Size statistics to output/Size_stats.csv
Saved Age statistics to output/Age_stats.csv</code></pre>
</div>
</div>
</section>
</section>
<section id="b.-绘制时序图并作简要分析" class="level4" data-number="41.3.0.2">
<h4 data-number="41.3.0.2" class="anchored" data-anchor-id="b.-绘制时序图并作简要分析"><span class="header-section-number">41.3.0.2</span> B. 绘制时序图并作简要分析：</h4>
<ul>
<li>B1. 横轴为&nbsp;年份，纵轴为&nbsp;Lev&nbsp;的均值和中位数</li>
</ul>
<div id="b0aed832" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb14-2"><a href="#cb14-2"></a>plt.rcParams[<span class="st">'font.sans-serif'</span>] <span class="op">=</span> [<span class="st">'Heiti SC'</span>, <span class="st">'PingFang SC'</span>, <span class="st">'Arial Unicode MS'</span>]</span>
<span id="cb14-3"><a href="#cb14-3"></a>plt.rcParams[<span class="st">'axes.unicode_minus'</span>] <span class="op">=</span> <span class="va">False</span></span>
<span id="cb14-4"><a href="#cb14-4"></a></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="co"># 读取 Lev_stats 数据</span></span>
<span id="cb14-6"><a href="#cb14-6"></a>lev_stats <span class="op">=</span> pd.read_csv(<span class="st">'output/Lev_stats.csv'</span>)</span>
<span id="cb14-7"><a href="#cb14-7"></a></span>
<span id="cb14-8"><a href="#cb14-8"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb14-9"><a href="#cb14-9"></a>plt.plot(lev_stats[<span class="st">'时间'</span>], lev_stats[<span class="st">'mean'</span>], label<span class="op">=</span><span class="st">'均值'</span>, marker<span class="op">=</span><span class="st">'o'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb14-10"><a href="#cb14-10"></a>plt.plot(lev_stats[<span class="st">'时间'</span>], lev_stats[<span class="st">'median'</span>], label<span class="op">=</span><span class="st">'中位数'</span>, marker<span class="op">=</span><span class="st">'o'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'orange'</span>)</span>
<span id="cb14-11"><a href="#cb14-11"></a></span>
<span id="cb14-12"><a href="#cb14-12"></a>plt.title(<span class="st">'Lev 时序图(2020-2024)'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb14-13"><a href="#cb14-13"></a>plt.xlabel(<span class="st">'年份'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb14-14"><a href="#cb14-14"></a>plt.ylabel(<span class="st">'Lev 值'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb14-15"><a href="#cb14-15"></a>plt.legend(fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb14-16"><a href="#cb14-16"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb14-17"><a href="#cb14-17"></a>plt.savefig(<span class="st">'output/Lev_时序图.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb14-18"><a href="#cb14-18"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="_ex02_吴倩茵_files/figure-html/cell-10-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>B2. 横轴为&nbsp;年份，纵轴为&nbsp;ROA&nbsp;和&nbsp;Cash&nbsp;的均值</li>
</ul>
<div id="35faaca2" class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># 设置中文字体（适配Mac）</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>plt.rcParams[<span class="st">'font.sans-serif'</span>] <span class="op">=</span> [<span class="st">'Heiti SC'</span>, <span class="st">'PingFang SC'</span>, <span class="st">'Arial Unicode MS'</span>]</span>
<span id="cb15-3"><a href="#cb15-3"></a>plt.rcParams[<span class="st">'axes.unicode_minus'</span>] <span class="op">=</span> <span class="va">False</span></span>
<span id="cb15-4"><a href="#cb15-4"></a></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="co"># 读取数据</span></span>
<span id="cb15-6"><a href="#cb15-6"></a>roa_stats <span class="op">=</span> pd.read_csv(<span class="st">'output/ROA_stats.csv'</span>)</span>
<span id="cb15-7"><a href="#cb15-7"></a>cash_stats <span class="op">=</span> pd.read_csv(<span class="st">'output/Cash_stats.csv'</span>)</span>
<span id="cb15-8"><a href="#cb15-8"></a></span>
<span id="cb15-9"><a href="#cb15-9"></a><span class="co"># 合并年份，确保年份一致</span></span>
<span id="cb15-10"><a href="#cb15-10"></a>years <span class="op">=</span> roa_stats[<span class="st">'时间'</span>]</span>
<span id="cb15-11"><a href="#cb15-11"></a></span>
<span id="cb15-12"><a href="#cb15-12"></a>fig, ax1 <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb15-13"><a href="#cb15-13"></a></span>
<span id="cb15-14"><a href="#cb15-14"></a><span class="co"># 绘制ROA均值</span></span>
<span id="cb15-15"><a href="#cb15-15"></a>ax1.plot(years, roa_stats[<span class="st">'mean'</span>], color<span class="op">=</span><span class="st">'blue'</span>, marker<span class="op">=</span><span class="st">'o'</span>, label<span class="op">=</span><span class="st">'ROA均值'</span>)</span>
<span id="cb15-16"><a href="#cb15-16"></a>ax1.set_xlabel(<span class="st">'年份'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb15-17"><a href="#cb15-17"></a>ax1.set_ylabel(<span class="st">'ROA均值'</span>, color<span class="op">=</span><span class="st">'blue'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb15-18"><a href="#cb15-18"></a>ax1.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelcolor<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb15-19"><a href="#cb15-19"></a></span>
<span id="cb15-20"><a href="#cb15-20"></a><span class="co"># 创建第二个y轴，绘制Cash均值</span></span>
<span id="cb15-21"><a href="#cb15-21"></a>ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb15-22"><a href="#cb15-22"></a>ax2.plot(years, cash_stats[<span class="st">'mean'</span>], color<span class="op">=</span><span class="st">'green'</span>, marker<span class="op">=</span><span class="st">'s'</span>, label<span class="op">=</span><span class="st">'Cash均值'</span>)</span>
<span id="cb15-23"><a href="#cb15-23"></a>ax2.set_ylabel(<span class="st">'Cash均值'</span>, color<span class="op">=</span><span class="st">'green'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb15-24"><a href="#cb15-24"></a>ax2.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelcolor<span class="op">=</span><span class="st">'green'</span>)</span>
<span id="cb15-25"><a href="#cb15-25"></a></span>
<span id="cb15-26"><a href="#cb15-26"></a><span class="co"># 标题与图例</span></span>
<span id="cb15-27"><a href="#cb15-27"></a>plt.title(<span class="st">'ROA与Cash均值时序图(2020-2024)'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb15-28"><a href="#cb15-28"></a>fig.tight_layout()</span>
<span id="cb15-29"><a href="#cb15-29"></a>plt.grid(<span class="va">True</span>, axis<span class="op">=</span><span class="st">'x'</span>)</span>
<span id="cb15-30"><a href="#cb15-30"></a>plt.savefig(<span class="st">'output/ROA_Cash_时序图.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb15-31"><a href="#cb15-31"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="_ex02_吴倩茵_files/figure-html/cell-11-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="c.-绘制时序图并作简要分析" class="level4" data-number="41.3.0.3">
<h4 data-number="41.3.0.3" class="anchored" data-anchor-id="c.-绘制时序图并作简要分析"><span class="header-section-number">41.3.0.3</span> C. 绘制时序图并作简要分析：</h4>
<p><strong>待分析的行业：</strong>&nbsp;制造业 (C)，电力、热力、燃气及水生产和供应业 (D)，交通运输业 (G)，建筑业 (E)，房地产业 (K)，批发和零售业 (F) 以及 金融业 (J)</p>
<div id="2e302b37" class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a>industry_group <span class="op">=</span> {</span>
<span id="cb16-2"><a href="#cb16-2"></a>    <span class="st">'C'</span>: <span class="st">'制造业'</span>,</span>
<span id="cb16-3"><a href="#cb16-3"></a>    <span class="st">'D'</span>: <span class="st">'电力、热力、燃气及水生产和供应业'</span>,</span>
<span id="cb16-4"><a href="#cb16-4"></a>    <span class="st">'G'</span>: <span class="st">'交通运输业'</span>,</span>
<span id="cb16-5"><a href="#cb16-5"></a>    <span class="st">'E'</span>: <span class="st">'建筑业'</span>,</span>
<span id="cb16-6"><a href="#cb16-6"></a>    <span class="st">'K'</span>: <span class="st">'房地产业'</span>,</span>
<span id="cb16-7"><a href="#cb16-7"></a>    <span class="st">'F'</span>: <span class="st">'批发和零售业'</span>,</span>
<span id="cb16-8"><a href="#cb16-8"></a>    <span class="st">'J'</span>: <span class="st">'金融业'</span></span>
<span id="cb16-9"><a href="#cb16-9"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><strong>算数平均负债率时序图</strong>：绘制上述行业在自 2000 年至今各个年度的&nbsp;年平均负债率 (Lev)&nbsp;的时序图</li>
</ul>
<div id="287e0815" class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="im">import</span> re</span>
<span id="cb17-4"><a href="#cb17-4"></a></span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="co"># 提取行业代码中的字母部分</span></span>
<span id="cb17-6"><a href="#cb17-6"></a>indicators[<span class="st">'行业字母'</span>] <span class="op">=</span> indicators[<span class="st">'行业代码'</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>.extract(<span class="vs">r'([A-Z])'</span>)</span>
<span id="cb17-7"><a href="#cb17-7"></a></span>
<span id="cb17-8"><a href="#cb17-8"></a><span class="co"># 只保留属于industry_group的行业</span></span>
<span id="cb17-9"><a href="#cb17-9"></a>industry_arlev_by_year <span class="op">=</span> indicators[indicators[<span class="st">'行业字母'</span>].isin(industry_group.keys())].copy()</span>
<span id="cb17-10"><a href="#cb17-10"></a></span>
<span id="cb17-11"><a href="#cb17-11"></a><span class="co"># 统计各行业各年度的年平均Lev值</span></span>
<span id="cb17-12"><a href="#cb17-12"></a>industry_lev_stats <span class="op">=</span> (</span>
<span id="cb17-13"><a href="#cb17-13"></a>    industry_arlev_by_year</span>
<span id="cb17-14"><a href="#cb17-14"></a>    .groupby([<span class="st">'时间'</span>, <span class="st">'行业字母'</span>])[<span class="st">'Lev'</span>]</span>
<span id="cb17-15"><a href="#cb17-15"></a>    .mean()</span>
<span id="cb17-16"><a href="#cb17-16"></a>    .reset_index()</span>
<span id="cb17-17"><a href="#cb17-17"></a>)</span>
<span id="cb17-18"><a href="#cb17-18"></a></span>
<span id="cb17-19"><a href="#cb17-19"></a><span class="co"># 行业字母转中文</span></span>
<span id="cb17-20"><a href="#cb17-20"></a>industry_lev_stats[<span class="st">'行业名称'</span>] <span class="op">=</span> industry_lev_stats[<span class="st">'行业字母'</span>].<span class="bu">map</span>(industry_group)</span>
<span id="cb17-21"><a href="#cb17-21"></a></span>
<span id="cb17-22"><a href="#cb17-22"></a><span class="co"># 保存结果</span></span>
<span id="cb17-23"><a href="#cb17-23"></a>industry_lev_stats.to_csv(<span class="st">'output/industry_arlev_by_year.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb17-24"><a href="#cb17-24"></a></span>
<span id="cb17-25"><a href="#cb17-25"></a><span class="co"># 绘制时序图</span></span>
<span id="cb17-26"><a href="#cb17-26"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">7</span>))</span>
<span id="cb17-27"><a href="#cb17-27"></a><span class="cf">for</span> code, name <span class="kw">in</span> industry_group.items():</span>
<span id="cb17-28"><a href="#cb17-28"></a>    data <span class="op">=</span> industry_lev_stats[industry_lev_stats[<span class="st">'行业字母'</span>] <span class="op">==</span> code]</span>
<span id="cb17-29"><a href="#cb17-29"></a>    plt.plot(data[<span class="st">'时间'</span>], data[<span class="st">'Lev'</span>], marker<span class="op">=</span><span class="st">'o'</span>, label<span class="op">=</span>name)</span>
<span id="cb17-30"><a href="#cb17-30"></a></span>
<span id="cb17-31"><a href="#cb17-31"></a>plt.title(<span class="st">'各行业年平均Lev时序图(2020-2024)'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb17-32"><a href="#cb17-32"></a>plt.xlabel(<span class="st">'年份'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb17-33"><a href="#cb17-33"></a>plt.ylabel(<span class="st">'年平均Lev值'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb17-34"><a href="#cb17-34"></a>plt.legend(fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb17-35"><a href="#cb17-35"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb17-36"><a href="#cb17-36"></a>plt.tight_layout()</span>
<span id="cb17-37"><a href="#cb17-37"></a>plt.savefig(<span class="st">'output/各行业年平均Lev时序图.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb17-38"><a href="#cb17-38"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="_ex02_吴倩茵_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><strong>加权平均负债率时序图：</strong>绘制上述行业在自 2000 年至今各个年度的&nbsp;年加权平均负债率 (Lev)&nbsp;的时序图，权重选择行业内每家公司的总资产</li>
</ul>
<div id="61453a79" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># 读取已缩尾处理的数据</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>indicators_winsorized <span class="op">=</span> pd.read_csv(<span class="st">'data_clean/indicators_winsorized.csv'</span>, dtype<span class="op">=</span>{<span class="st">'证券代码'</span>: <span class="bu">str</span>})</span>
<span id="cb18-3"><a href="#cb18-3"></a></span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="co"># 提取行业代码中的字母部分</span></span>
<span id="cb18-5"><a href="#cb18-5"></a>indicators_winsorized[<span class="st">'行业字母'</span>] <span class="op">=</span> indicators_winsorized[<span class="st">'行业代码'</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>.extract(<span class="vs">r'([A-Z])'</span>)</span>
<span id="cb18-6"><a href="#cb18-6"></a></span>
<span id="cb18-7"><a href="#cb18-7"></a>filtered_data <span class="op">=</span> indicators_winsorized[</span>
<span id="cb18-8"><a href="#cb18-8"></a>    (indicators_winsorized[<span class="st">'行业字母'</span>].isin(industry_group.keys())) <span class="op">&amp;</span></span>
<span id="cb18-9"><a href="#cb18-9"></a>    (indicators_winsorized[<span class="st">'时间'</span>] <span class="op">&gt;=</span> <span class="dv">2000</span>) <span class="op">&amp;</span> (indicators_winsorized[<span class="st">'时间'</span>] <span class="op">&lt;=</span> <span class="dv">2024</span>)</span>
<span id="cb18-10"><a href="#cb18-10"></a>]</span>
<span id="cb18-11"><a href="#cb18-11"></a></span>
<span id="cb18-12"><a href="#cb18-12"></a><span class="co"># 计算加权平均负债率 (Lev)，权重为总资产</span></span>
<span id="cb18-13"><a href="#cb18-13"></a>weighted_lev <span class="op">=</span> (</span>
<span id="cb18-14"><a href="#cb18-14"></a>    filtered_data.groupby([<span class="st">'时间'</span>, <span class="st">'行业字母'</span>])</span>
<span id="cb18-15"><a href="#cb18-15"></a>    .<span class="bu">apply</span>(<span class="kw">lambda</span> x: (x[<span class="st">'Lev'</span>] <span class="op">*</span> x[<span class="st">'总资产'</span>]).<span class="bu">sum</span>() <span class="op">/</span> x[<span class="st">'总资产'</span>].<span class="bu">sum</span>())</span>
<span id="cb18-16"><a href="#cb18-16"></a>    .reset_index(name<span class="op">=</span><span class="st">'加权平均Lev'</span>)</span>
<span id="cb18-17"><a href="#cb18-17"></a>)</span>
<span id="cb18-18"><a href="#cb18-18"></a></span>
<span id="cb18-19"><a href="#cb18-19"></a><span class="co"># 行业字母转中文</span></span>
<span id="cb18-20"><a href="#cb18-20"></a>weighted_lev[<span class="st">'行业名称'</span>] <span class="op">=</span> weighted_lev[<span class="st">'行业字母'</span>].<span class="bu">map</span>(industry_group)</span>
<span id="cb18-21"><a href="#cb18-21"></a></span>
<span id="cb18-22"><a href="#cb18-22"></a><span class="co"># 保存结果</span></span>
<span id="cb18-23"><a href="#cb18-23"></a>weighted_lev.to_csv(<span class="st">'output/industry_weightedlev_by_year.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb18-24"><a href="#cb18-24"></a></span>
<span id="cb18-25"><a href="#cb18-25"></a><span class="co"># 绘制加权平均负债率时序图</span></span>
<span id="cb18-26"><a href="#cb18-26"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">7</span>))</span>
<span id="cb18-27"><a href="#cb18-27"></a><span class="cf">for</span> code, name <span class="kw">in</span> industry_group.items():</span>
<span id="cb18-28"><a href="#cb18-28"></a>    data <span class="op">=</span> weighted_lev[weighted_lev[<span class="st">'行业字母'</span>] <span class="op">==</span> code]</span>
<span id="cb18-29"><a href="#cb18-29"></a>    plt.plot(data[<span class="st">'时间'</span>], data[<span class="st">'加权平均Lev'</span>], marker<span class="op">=</span><span class="st">'o'</span>, label<span class="op">=</span>name)</span>
<span id="cb18-30"><a href="#cb18-30"></a></span>
<span id="cb18-31"><a href="#cb18-31"></a>plt.title(<span class="st">'各行业加权平均Lev时序图 (2000-2024)'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb18-32"><a href="#cb18-32"></a>plt.xlabel(<span class="st">'年份'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb18-33"><a href="#cb18-33"></a>plt.ylabel(<span class="st">'加权平均Lev值'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb18-34"><a href="#cb18-34"></a>plt.legend(fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb18-35"><a href="#cb18-35"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb18-36"><a href="#cb18-36"></a>plt.tight_layout()</span>
<span id="cb18-37"><a href="#cb18-37"></a>plt.savefig(<span class="st">'output/各行业加权平均Lev时序图.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb18-38"><a href="#cb18-38"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="_ex02_吴倩茵_files/figure-html/cell-14-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><strong>列表:</strong> 呈现上述行业在 {2001, 2003, 2005, 2007, 2009, 2011, 2013, 2015, 2017, 2019, 2021, 2023}年度的如下变量的平均值
<ul>
<li>SLoan, LLoan, Lev</li>
<li>Cash, ROA, ROE</li>
</ul></li>
</ul>
<div id="cd23ff95" class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># 读取缩尾处理后的数据</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>indicators <span class="op">=</span> pd.read_csv(<span class="st">'data_clean/indicators_winsorized.csv'</span>, dtype<span class="op">=</span>{<span class="st">'证券代码'</span>: <span class="bu">str</span>})</span>
<span id="cb19-3"><a href="#cb19-3"></a></span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="co"># 需要的年份</span></span>
<span id="cb19-5"><a href="#cb19-5"></a>years <span class="op">=</span> [<span class="dv">2001</span>, <span class="dv">2003</span>, <span class="dv">2005</span>, <span class="dv">2007</span>, <span class="dv">2009</span>, <span class="dv">2011</span>, <span class="dv">2013</span>, <span class="dv">2015</span>, <span class="dv">2017</span>, <span class="dv">2019</span>, <span class="dv">2021</span>, <span class="dv">2023</span>]</span>
<span id="cb19-6"><a href="#cb19-6"></a></span>
<span id="cb19-7"><a href="#cb19-7"></a><span class="co"># 提取行业代码中的字母部分</span></span>
<span id="cb19-8"><a href="#cb19-8"></a>indicators[<span class="st">'行业字母'</span>] <span class="op">=</span> indicators[<span class="st">'行业代码'</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>.extract(<span class="vs">r'([A-Z])'</span>)</span>
<span id="cb19-9"><a href="#cb19-9"></a></span>
<span id="cb19-10"><a href="#cb19-10"></a><span class="co"># 只保留指定行业和年份</span></span>
<span id="cb19-11"><a href="#cb19-11"></a>filtered <span class="op">=</span> indicators[</span>
<span id="cb19-12"><a href="#cb19-12"></a>    (indicators[<span class="st">'行业字母'</span>].isin(industry_group.keys())) <span class="op">&amp;</span></span>
<span id="cb19-13"><a href="#cb19-13"></a>    (indicators[<span class="st">'时间'</span>].isin(years))</span>
<span id="cb19-14"><a href="#cb19-14"></a>]</span>
<span id="cb19-15"><a href="#cb19-15"></a></span>
<span id="cb19-16"><a href="#cb19-16"></a><span class="co"># 变量列表</span></span>
<span id="cb19-17"><a href="#cb19-17"></a>vars_to_show <span class="op">=</span> [<span class="st">'SLoan'</span>, <span class="st">'LLoan'</span>, <span class="st">'Lev'</span>, <span class="st">'Cash'</span>, <span class="st">'ROA'</span>, <span class="st">'ROE'</span>]</span>
<span id="cb19-18"><a href="#cb19-18"></a></span>
<span id="cb19-19"><a href="#cb19-19"></a><span class="co"># 分组聚合</span></span>
<span id="cb19-20"><a href="#cb19-20"></a>result <span class="op">=</span> (</span>
<span id="cb19-21"><a href="#cb19-21"></a>    filtered.groupby([<span class="st">'时间'</span>, <span class="st">'行业字母'</span>])[vars_to_show]</span>
<span id="cb19-22"><a href="#cb19-22"></a>    .mean()</span>
<span id="cb19-23"><a href="#cb19-23"></a>    .reset_index()</span>
<span id="cb19-24"><a href="#cb19-24"></a>)</span>
<span id="cb19-25"><a href="#cb19-25"></a></span>
<span id="cb19-26"><a href="#cb19-26"></a><span class="co"># 行业字母转中文</span></span>
<span id="cb19-27"><a href="#cb19-27"></a>result[<span class="st">'行业名称'</span>] <span class="op">=</span> result[<span class="st">'行业字母'</span>].<span class="bu">map</span>(industry_group)</span>
<span id="cb19-28"><a href="#cb19-28"></a></span>
<span id="cb19-29"><a href="#cb19-29"></a><span class="co"># 调整列顺序</span></span>
<span id="cb19-30"><a href="#cb19-30"></a>result <span class="op">=</span> result[[<span class="st">'时间'</span>,<span class="st">'行业名称'</span>] <span class="op">+</span> vars_to_show]</span>
<span id="cb19-31"><a href="#cb19-31"></a></span>
<span id="cb19-32"><a href="#cb19-32"></a><span class="co"># 按行业分别保存</span></span>
<span id="cb19-33"><a href="#cb19-33"></a><span class="cf">for</span> name <span class="kw">in</span> result[<span class="st">'行业名称'</span>].unique():</span>
<span id="cb19-34"><a href="#cb19-34"></a>    df_ind <span class="op">=</span> result[result[<span class="st">'行业名称'</span>] <span class="op">==</span> name]</span>
<span id="cb19-35"><a href="#cb19-35"></a>    df_ind.to_csv(<span class="ss">f'output/</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">_年度指标分析.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb19-36"><a href="#cb19-36"></a></span>
<span id="cb19-37"><a href="#cb19-37"></a><span class="co"># 总表也保存</span></span>
<span id="cb19-38"><a href="#cb19-38"></a>result.to_csv(<span class="st">'output/行业年度均值列表.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb19-39"><a href="#cb19-39"></a></span>
<span id="cb19-40"><a href="#cb19-40"></a><span class="co"># 展示前几行</span></span>
<span id="cb19-41"><a href="#cb19-41"></a><span class="bu">print</span>(result.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     时间              行业名称     SLoan     LLoan       Lev      Cash       ROA  \
0  2001               制造业  0.172146  0.053447  0.442680  0.182836  0.018141   
1  2001  电力、热力、燃气及水生产和供应业  0.080644  0.090504  0.344225  0.150597  0.053151   
2  2001               建筑业  0.174406  0.040511  0.588493  0.162704  0.008544   
3  2001            批发和零售业  0.220469  0.032159  0.523009  0.152795  0.008498   
4  2001             交通运输业  0.101300  0.087389  0.357147  0.167707  0.044602   

        ROE  
0  0.025752  
1  0.084122  
2  0.013694  
3  0.027081  
4  0.066067  </code></pre>
</div>
</div>
</section>
<section id="d.-股权结构分析" class="level4" data-number="41.3.0.4">
<h4 data-number="41.3.0.4" class="anchored" data-anchor-id="d.-股权结构分析"><span class="header-section-number">41.3.0.4</span> D. 股权结构分析：</h4>
<ul>
<li>绘制箱线图
<ul>
<li>横轴为&nbsp;年份，纵轴为&nbsp;Top1&nbsp;的值。年份取值为：{2001, 2003, 2005, 2007, 2009, 2011, 2013, 2015, 2017, 2019, 2021, 2023}。</li>
</ul></li>
</ul>
<div id="463e6e2e" class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># 读取缩尾处理后的数据</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>indicators <span class="op">=</span> pd.read_csv(<span class="st">'data_clean/indicators_winsorized.csv'</span>, dtype<span class="op">=</span>{<span class="st">'证券代码'</span>: <span class="bu">str</span>})</span>
<span id="cb21-3"><a href="#cb21-3"></a></span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="co"># 指定年份</span></span>
<span id="cb21-5"><a href="#cb21-5"></a>years <span class="op">=</span> [<span class="dv">2001</span>, <span class="dv">2003</span>, <span class="dv">2005</span>, <span class="dv">2007</span>, <span class="dv">2009</span>, <span class="dv">2011</span>, <span class="dv">2013</span>, <span class="dv">2015</span>, <span class="dv">2017</span>, <span class="dv">2019</span>, <span class="dv">2021</span>, <span class="dv">2023</span>]</span>
<span id="cb21-6"><a href="#cb21-6"></a></span>
<span id="cb21-7"><a href="#cb21-7"></a><span class="co"># 只保留指定年份的数据，且Top1非缺失</span></span>
<span id="cb21-8"><a href="#cb21-8"></a>filtered <span class="op">=</span> indicators[indicators[<span class="st">'时间'</span>].isin(years) <span class="op">&amp;</span> indicators[<span class="st">'Top1'</span>].notna()]</span>
<span id="cb21-9"><a href="#cb21-9"></a></span>
<span id="cb21-10"><a href="#cb21-10"></a><span class="co"># 按年份准备数据</span></span>
<span id="cb21-11"><a href="#cb21-11"></a>data <span class="op">=</span> [filtered[filtered[<span class="st">'时间'</span>] <span class="op">==</span> year][<span class="st">'Top1'</span>] <span class="cf">for</span> year <span class="kw">in</span> years]</span>
<span id="cb21-12"><a href="#cb21-12"></a></span>
<span id="cb21-13"><a href="#cb21-13"></a><span class="co"># 绘制箱线图</span></span>
<span id="cb21-14"><a href="#cb21-14"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">7</span>))</span>
<span id="cb21-15"><a href="#cb21-15"></a>plt.boxplot(data, labels<span class="op">=</span>years, patch_artist<span class="op">=</span><span class="va">True</span>, showmeans<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb21-16"><a href="#cb21-16"></a>plt.xlabel(<span class="st">'年份'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb21-17"><a href="#cb21-17"></a>plt.ylabel(<span class="st">'Top1（第一大股东持股比例）'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb21-18"><a href="#cb21-18"></a>plt.title(<span class="st">'不同年份Top1箱线图'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb21-19"><a href="#cb21-19"></a>plt.grid(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb21-20"><a href="#cb21-20"></a>plt.tight_layout()</span>
<span id="cb21-21"><a href="#cb21-21"></a>plt.savefig(<span class="st">'output/Top1_年份箱线图.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb21-22"><a href="#cb21-22"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="_ex02_吴倩茵_files/figure-html/cell-16-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/book\.lianxh\.cn\/ds\/index\.html");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../homework/pre/_ex02_万诗晴.html" class="pagination-link" aria-label="ex02_万诗晴">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">ex02_万诗晴</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../homework/pre/_ex02_朱少荣.html" class="pagination-link" aria-label="ex02_朱少荣">
        <span class="nav-page-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">ex02_朱少荣</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p><a href="https://www.lianxh.cn">www.lianxh.cn</a></p>
</div>
    <div class="nav-footer-right">
<p>Support: <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>